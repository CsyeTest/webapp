# Deployment guide digitalOcean

### 1. Access Your Droplet via SSH

 - Use the SSH command to connect to your droplet. Replace `your_droplet_ip` with the IP address of your droplet:

   ```
     ssh root@your_droplet_ip
   ```
 - Make sure ssh key generated by ssh-keygen & configured in digitalOcean
  
### 2. Update Your Droplet (First Time Activity Mostly)
  
  ```
  sudo dnf update -y
  ```
 
### 3. Install Node.js	


1. **Import NodeSource Repository**:
   - First, you'll need to download and execute the NodeSource installation script for Node.js v20.x. You can do this with `curl` and execute the script with . `Open your terminal and run`
     ```
     curl -sL https://rpm.nodesource.com/setup_20.x | sudo bash -
     ```

2. **Install Node.js**:
   - Once the repository has been added, you can install Node.js with `dnf` (CentOS 8 and later). Since CentOS 8 and later versions use `dnf`

     ```
     sudo dnf install -y nodejs
     ```

3. **Verify Installation**:
   - After installation, verify that Node.js and npm are correctly installed 

     ```
     node -v
     ```
     ```
     npm -v
     ```
### 4. Install PostgreSQL

   - Install PostgreSQL on your droplet

	```
	sudo dnf install -y postgresql-server postgresql-contrib
	```

   - Initialize the database and enable it to start on boot

	```
	sudo postgresql-setup --initdb
 	```
  	```
	sudo systemctl start postgresql
 	```
  	```
	sudo systemctl enable postgresql
	```

### 5. Configure PostgreSQL

 - Switch to the `postgres` user and create a new database and user for your application

	```
	sudo -i -u postgres
	createdb cloud_db
	psql -d cloud_db
	CREATE ROLE cloud_admin WITH LOGIN PASSWORD 'password';
	GRANT ALL PRIVILEGES ON DATABASE cloud_db TO cloud_admin;
	vi /var/lib/pgsql/data/pg_hba.conf
	```
- in pg_hba.conf make IPv4 and IPv6 local connection method *ident* to *md5*
	
	```
     host    all             all             127.0.0.1/32            ident
     host    all             all             ::1/128                 ident
     ```
- Restart postgres after that
	
	```
	systemctl restart postgresql

	```

### 6. Transfer Your Web App to the Droplet

- Use `scp` to transfer your application files to the droplet

	```
	scp -r webapp-main.zip root@your_droplet_ip:/home
	```
- Unzip it

	```
	sudo dnf install zip
	unzip webapp-main.zip
	```

### 7. Install Your App Dependencies

SSH back into your droplet, navigate to your app's directory, and install dependencies:

	```
	cd /home/webapp
	npm install
	```

### 8. Configure Environment Variables

Configuration of .env file
	```
	cat .env.example > .env
	vi .env
	```

### 9. Start Your Application

	```					
	node server.js
	```

### 10. Hit API REQUEST
 ```
 curl -vvvv http://localhost:8080/healthz
 ```
 ```
 curl -X POST \
  http://localhost:8080/v1/user \
  -H 'Content-Type: application/json' \
  -d '{
    "first_name": "nitesh",
    "last_name": "more",
    "password": "nitesh123",
    "username": "nitesh@email.com"
    }'
```
- to get encoded value for header
  
	```
	 echo -n 'username:password' | base64
	```

	```
	curl -X GET \
	  http://localhost:8080/v1/user \
	  -H 'Authorization: Basic bml0ZXNoQGVtYWlsLmNvbTpuaXRlc2gxMjM='

	 ```
